<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Casa & Imago Frame</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        [x-cloak] { display: none !important; }
        
        /* Input Number Rapi (Hilangkan Spinner) */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        .touch-manipulation { touch-action: manipulation; }
    </style>

    <script>
        function stockApp() {
            return {
                items: [],
                searchQuery: '',
                showCalc: false,
                calcDisplay: '',
                
                get filteredItems() {
                    if (this.searchQuery === '') return this.items;
                    return this.items.filter(i => i.name.toLowerCase().includes(this.searchQuery.toLowerCase()));
                },

                // 1. Upload Excel (Master Data)
                handleFileUpload(e) {
                    const file = e.target.files[0];
                    if (!file) return;
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        try {
                            const data = new Uint8Array(event.target.result);
                            const workbook = XLSX.read(data, { type: 'array' });
                            const sheetName = workbook.SheetNames[0];
                            const json = XLSX.utils.sheet_to_json(workbook.Sheets[sheetName], { header: 1 });
                            this.items = json.slice(1).map((row, i) => ({
                                id: Date.now() + i,
                                name: row[0] || 'Tanpa Nama',
                                rak: '', m1: '', m2: '', m3: '', m4: ''
                            })).filter(i => i.name && i.name !== 'Tanpa Nama');
                            e.target.value = ''; 
                        } catch (err) { alert("Gagal baca Excel. Pastikan format .xlsx"); }
                    };
                    reader.readAsArrayBuffer(file);
                },

                // 2. Download Backup (Simpan JSON)
                downloadBackup() {
                    const dataStr = JSON.stringify(this.items);
                    const blob = new Blob([dataStr], {type: "application/json"});
                    const url = URL.createObjectURL(blob);
                    
                    const now = new Date();
                    // Format waktu file: backup_casa_imago_jam-menit.json
                    const time = `${now.getHours()}.${
